------- FILE /Users/frederik/Documents/Eclipse/workspace/MidiJoy/MJ2600.asm LEVEL 1 PASS 2
      1  10000 ????						; MidiJoy for Atari VCS 2600 (c) 2014 by Frederik Holst
      2  10000 ????						; Interface port 1 -> VCS right port
      3  10000 ????						; Interface port 2 -> VCS left port
      4  10000 ????						; compiled with DASM
      5  10000 ????
      6  10000 ????				       processor	6502
      7  10000 ????
      8  10000 ????		00 09	    COLUBK     =	$09
      9  10000 ????		00 15	    AUDC0      =	$15
     10  10000 ????		00 16	    AUDC1      =	$16
     11  10000 ????		00 17	    AUDF0      =	$17
     12  10000 ????		00 19	    AUDV0      =	$19
     13  10000 ????		00 1b	    GRP0       =	$1b
     14  10000 ????		00 3c	    INPT4      =	$3c
     15  10000 ????		02 80	    SWCHA      =	$280
     16  10000 ????
     17  f000					      org	$f000
     18  f000
     19  f000				   start
     20  f000		       78		      sei		; clear memory
     21  f001		       d8		      cld
     22  f002		       a2 ff		      ldx	#$ff
     23  f004		       9a		      txs
     24  f005		       a9 00		      lda	#0
     25  f007		       95 00	   ClearMem   sta	0,x
     26  f009		       ca		      dex
     27  f00a		       d0 fb		      bne	ClearMem
     28  f00c
     29  f00c		       a9 04		      lda	#4	; initialize TIA "sound"chip, adjust here for different distortions
     30  f00e		       85 15		      sta	AUDC0
     31  f010		       85 16		      sta	AUDC1
     32  f012
     33  f012		       a2 ff	   loop       ldx	#255	; The dT delay in the Teensy code is set to accomodate more code on the
     34  f014		       ca	   wait       dex		; computer side. Remove or replace this loop with your own sound processing code
     35  f015		       d0 fd		      bne	wait	; or decrease dT delay in Teensy code it used for playback only
     36  f017
     37  f017		       a5 3c		      lda	INPT4	; Take voice channel from Trigger 1
     38  f019		       29 80		      and	#%10000000
     39  f01b		       18		      clc
     40  f01c		       2a		      rol		; save resulting voice index in Y register (0 or 1)
     41  f01d		       2a		      rol		; by shifting bit 7 to carry and then from carry to bit 0
     42  f01e		       a8		      tay
     43  f01f
     44  f01f		       ad 80 02 	      lda	SWCHA	; read joysticks 1+2
     45  f022		       c9 80		      cmp	#%10000000	; if bit 7 is set then volume data follows, otherwise pitch
     46  f024		       90 0a		      bcc	setpitch
     47  f026
     48  f026				   setvolume
     49  f026		       29 0f		      and	#%00001111	; mask lower four bits of Midi data which contain volume information
     50  f028		       99 19 00 	      sta	AUDV0,y	; and set based on voice index (from Y)
     51  f02b		       85 09		      sta	COLUBK	; some visual feedback :-)
     52  f02d		       4c 12 f0 	      jmp	loop
     53  f030
     54  f030				   setpitch
     55  f030		       29 1f		      and	#%00011111	; lower 5 bits contain frequency value (0-31)
     56  f032		       aa		      tax
     57  f033		       bd 3f f0 	      lda	NoteTable,x	; read from note table below based on frequency value
     58  f036		       99 17 00 	      sta	AUDF0,y	; and set based on voice index (from Y)
     59  f039		       99 1b 00 	      sta	GRP0,y	; some visual feedback :-)
     60  f03c		       4c 12 f0 	      jmp	loop
     61  f03f
     62  f03f							; note table tries to match chromatic scale in distortion 4
     63  f03f		       1d 1b 1a 18*NoteTable  .byte.b	29, 27, 26, 24, 23, 22, 20, 19, 18, 17, 16, 15
     64  f04b		       1d 1b 1a 18*	      .byte.b	29, 27, 26, 24, 23, 22, 20, 19, 18, 17, 16, 15
     65  f057		       1d 1b 1a 18*	      .byte.b	29, 27, 26, 24, 23, 22, 20, 19, 18, 17, 16, 15
     66  f063		       1d 1b 1a 18*	      .byte.b	29, 27, 26, 24, 23, 22, 20, 19, 18, 17, 16, 15
     67  f06f		       1d 1b 1a 18*	      .byte.b	29, 27, 26, 24, 23, 22, 20, 19, 18, 17, 16, 15
     68  f07b		       1d 1b 1a 18*	      .byte.b	29, 27, 26, 24, 23, 22, 20, 19, 18, 17, 16, 15
     69  f087		       1d 1b 1a 18*	      .byte.b	29, 27, 26, 24, 23, 22, 20, 19, 18, 17, 16, 15
     70  f093		       1d 1b 1a 18*	      .byte.b	29, 27, 26, 24, 23, 22, 20, 19, 18, 17, 16, 15
     71  f09f
     72  f09f							; alternative note table matches every 32 frequencies of the VCS, no correlation to chromatic scale
     73  f09f							;NoteTable	.byte 31, 30, 29, 28, 27, 26, 25, 24, 23, 22, 21, 20
     74  f09f							;			.byte 19, 18, 17, 16, 15, 14, 13, 12, 11, 10
     75  f09f							;			.byte 9, 8, 7, 6, 5, 4, 3, 2, 1, 0
     76  f09f
     77  fffc					      org	$fffc
     78  fffc		       00 f0		      .word.w	start
     79  fffe		       00 f0		      .word.w	start
